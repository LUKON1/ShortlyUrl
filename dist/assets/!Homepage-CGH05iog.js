import{u as N,r as m,j as e,T as I,m as g,A as U,a as _,b as E}from"./index-D21EAcOg.js";import{g as T,c as D,U as M}from"./utm_builder-CcVyatFW.js";import{N as P,H as A}from"./h1-CngdnrfK.js";import{u as Y}from"./useAxiosPrivate-MDmYBEkr.js";import{P as $}from"./wrapper_home-NSVHF-mD.js";function z({shortUrl:t}){const{t:r}=N(),[s,a]=m.useState("");return e.jsx("button",{type:"button",className:"touch-manipulation transition-all duration-200 ease-out hover:bg-blue-500 dark:hover:bg-rose-600 active:bg-blue-600 dark:active:bg-rose-700 bg-blue-400 dark:bg-rose-500 shadow-lg hover:shadow-xl h-16 lg:h-20 w-64 text-1xl md:text-2xl lg:text-3xl p-4 rounded-lg text-white dark:text-white font-extrabold",onClick:()=>{navigator.clipboard.writeText(t).then(()=>{a(!0),setTimeout(()=>{a("")},4e3)})},children:r(s?"homepage.copied":"homepage.copy")})}function L({isLoading:t}){const{t:r}=N(),{theme:s}=m.useContext(I),a=s==="dark";return e.jsxs(g.button,{type:"submit",disabled:t,className:"motion-safe text-1xl group relative flex h-16 w-64 cursor-pointer touch-manipulation items-center justify-center overflow-hidden rounded-lg p-2 font-extrabold text-gray-900 shadow-lg hover:shadow-xl disabled:cursor-not-allowed disabled:opacity-50 md:text-2xl lg:h-20 lg:text-3xl dark:text-gray-100",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)",background:a?"linear-gradient(to right, #0ea5e9, #3b82f6)":"linear-gradient(to right, #0ea5e9, #2563eb)"},transition:{duration:.8,ease:"easeOut",delay:.2},whileHover:"hover",whileFocus:"hover",whileTap:{scale:.95},children:[e.jsx(g.div,{className:"absolute -top-4 right-32 z-10 h-40 w-40 rounded-full bg-blue-200 dark:bg-sky-800",style:{transition:"var(--transition-bg)"},variants:{hover:{top:4,scale:1.5,right:8}},transition:{duration:.5,ease:"easeOut"}}),e.jsx(g.div,{className:"absolute -top-4 right-2 z-10 h-32 w-32 rounded-full bg-slate-100 dark:bg-blue-900",style:{transition:"var(--transition-bg)"},variants:{hover:{top:4,scale:1.5,right:8}},transition:{duration:.5,ease:"easeOut"}}),e.jsx(g.div,{className:"absolute top-4 -right-12 z-10 h-24 w-24 rounded-full bg-blue-200 dark:bg-sky-800",style:{transition:"var(--transition-bg)"},variants:{hover:{top:4,right:8,scale:1.5}},transition:{duration:.5,ease:"easeOut"}}),e.jsx(g.div,{className:"absolute -top-4 right-20 z-10 h-16 w-16 rounded-full bg-sky-400 dark:bg-sky-600",style:{transition:"var(--transition-bg)"},variants:{hover:{top:4,right:8,scale:1.5}},transition:{duration:.5,ease:"easeOut"}}),e.jsx("p",{className:"relative z-10",children:r(t?"homepage.cutting":"homepage.cut")})]})}function B({shortUrl:t,qrContainerRef:r}){const[s,a]=m.useState(null);return m.useEffect(()=>{let n=!0;return(async()=>{if(t){const p=await T(t);n&&a(p)}})(),()=>{n=!1}},[t]),s?e.jsx("div",{ref:r,className:"relative flex flex-col items-center",children:e.jsx("img",{src:s,alt:"QR",className:"user-select-all h-64 w-64 rounded-4xl border-5 border-rose-300 object-contain dark:border-[#00a6f4]"})}):null}function F({shortUrl:t,url:r}){const{t:s}=N(),a=async()=>{if(!t)return;const n=await T(t);if(!n)return;const d=new URL(r).hostname.split(".").slice(-2).join("."),c=document.createElement("a");c.href=n,c.download=`${d}-QRcode.png`,document.body.appendChild(c),c.click(),document.body.removeChild(c)};return e.jsx("div",{children:e.jsx("button",{onClick:a,type:"button",className:"text-1xl h-16 w-64 touch-manipulation rounded-lg bg-blue-400 p-4 font-extrabold text-white shadow-lg transition-all duration-200 ease-out hover:bg-blue-500 hover:shadow-xl active:bg-blue-600 md:text-2xl lg:h-20 lg:text-3xl dark:bg-rose-500 dark:text-white dark:hover:bg-rose-600 dark:active:bg-rose-700",children:s("homepage.downloadqr")})})}const Q=t=>{const r=window.location.host,a=[window.location.hostname,r];return new RegExp(`^(https?://)?(www.)?(${a.join("|")})(/|$)`,"i").test(t)};function C({id:t,icon:r,title:s,summary:a,isOpen:n,onToggle:h,children:p}){return e.jsxs("div",{className:"border-b border-sky-100 last:border-b-0 dark:border-slate-700/60",children:[e.jsxs("button",{type:"button",onClick:h,className:"flex w-full cursor-pointer touch-manipulation items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-sky-50/50 md:px-5 md:py-3.5 dark:hover:bg-slate-700/30",children:[e.jsx("span",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-sky-100/80 text-sky-600 dark:bg-sky-900/40 dark:text-sky-400",children:r}),e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:s}),!n&&a&&e.jsx("span",{className:"truncate text-xs text-gray-400 dark:text-gray-500",children:a})]}),e.jsx("svg",{className:`h-4 w-4 shrink-0 text-gray-400 transition-transform duration-200 dark:text-gray-500 ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx(U,{initial:!1,children:n&&e.jsx(g.div,{className:"motion-safe overflow-hidden",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},children:e.jsx("div",{className:"px-4 pt-1 pb-4 md:px-5 md:pb-5",children:p})})})]})}function H({value:t,onChange:r,options:s}){const{t:a}=N(),[n,h]=m.useState(!1),[p,i]=m.useState("1"),[d,c]=m.useState(86400),b=m.useRef(null);m.useEffect(()=>{n&&b.current&&b.current.focus()},[n]);const y=31536e3,u=[{label:a("homepage.urlopt.urtime.minutes"),value:60},{label:a("homepage.urlopt.urtime.hour"),value:3600},{label:a("homepage.urlopt.urtime.day"),value:86400},{label:a("homepage.urlopt.urtime.week"),value:604800},{label:a("homepage.urlopt.urtime.month"),value:2592e3},{label:a("homepage.urlopt.urtime.year"),value:31536e3}],k=s.some(o=>o.value===t),v=()=>{let w=(parseInt(p)||1)*d;w>y&&(w=y,i("1"),c(y)),w<60&&(w=60),r(w),h(!1)},l=o=>{o.key==="Enter"?(o.preventDefault(),v()):o.key==="Escape"&&h(!1)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.map(o=>e.jsx("button",{type:"button",onClick:()=>{r(o.value),h(!1)},className:`rounded-lg px-3 py-1.5 text-sm font-medium transition-colors ${t===o.value&&!n?"bg-sky-500 text-white shadow-sm dark:bg-sky-600":"bg-sky-50 text-gray-600 hover:bg-sky-100 dark:bg-slate-700 dark:text-gray-300 dark:hover:bg-slate-600"}`,children:o.label},o.value)),e.jsx("button",{type:"button",onClick:()=>h(!0),className:`rounded-lg px-3 py-1.5 text-sm font-medium transition-colors ${n||!k?"bg-sky-500 text-white shadow-sm dark:bg-sky-600":"bg-sky-50 text-gray-600 hover:bg-sky-100 dark:bg-slate-700 dark:text-gray-300 dark:hover:bg-slate-600"}`,children:a("homepage.urlopt.urtime.custom")})]}),e.jsx(U,{initial:!1,children:n&&e.jsx(g.div,{className:"motion-safe overflow-hidden",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2,ease:"easeInOut"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:b,type:"number",min:"1",max:"999",value:p,onChange:o=>i(o.target.value),onKeyDown:l,className:"w-18 rounded-md border border-sky-200 bg-sky-50/50 px-2.5 py-1.5 text-sm text-gray-900 focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900/60 dark:text-white"}),e.jsx("select",{value:d,onChange:o=>c(parseInt(o.target.value)),className:"flex-1 rounded-md border border-sky-200 bg-sky-50/50 px-2.5 py-1.5 text-sm text-gray-900 focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-slate-600 dark:bg-slate-900/60 dark:text-white",children:u.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))}),e.jsx("button",{type:"button",onClick:v,className:"shrink-0 rounded-md bg-sky-500 px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:bg-sky-600 dark:hover:bg-sky-400",children:a("homepage.urlopt.urtime.confirm")})]})})})]})}const W=e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),G=e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),J=e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})});function V({urlTime:t,setUrlTime:r,urlTimeOptions:s,customAlias:a,setCustomAlias:n,utm:h,setUtm:p}){const{t:i}=N(),[d,c]=m.useState({lifetime:!0,alias:!1,utm:!1}),b=l=>{c(o=>({...o,[l]:!o[l]}))},y=s.find(l=>l.value===t)?.label||"",u=a?`${window.location.host}/${a}`:i("homepage.settings.aliasSummary"),v=Object.values(h).some(l=>l.trim()!=="")?Object.entries(h).filter(([,l])=>l.trim()).map(([l])=>l).join(", "):i("homepage.settings.utmSummary");return e.jsxs("div",{className:"w-full overflow-hidden rounded-xl border border-sky-100 bg-white/95 shadow-sm backdrop-blur-sm dark:border-slate-700 dark:bg-slate-800/95",children:[e.jsx(C,{id:"lifetime",icon:W,title:i("homepage.settings.lifetime"),summary:y,isOpen:d.lifetime,onToggle:()=>b("lifetime"),children:e.jsx(H,{value:t,onChange:r,options:s})}),e.jsx(C,{id:"alias",icon:G,title:i("homepage.settings.alias"),summary:u,isOpen:d.alias,onToggle:()=>b("alias"),children:e.jsxs("div",{className:"flex items-center overflow-hidden rounded-md border border-sky-200 bg-sky-50/50 dark:border-slate-600 dark:bg-slate-900/60",children:[e.jsxs("span",{className:"shrink-0 border-r border-sky-200 bg-sky-100/80 px-2.5 py-2 text-xs font-medium text-sky-700 select-none dark:border-sky-800 dark:bg-sky-900/40 dark:text-sky-300",children:[window.location.host,"/"]}),e.jsx("input",{type:"text",value:a,onChange:l=>n(l.target.value.replace(/[^a-zA-Z0-9-_]/g,"")),placeholder:i("homepage.urlopt.aliasPlaceholder"),className:"w-full min-w-0 flex-1 bg-transparent px-2.5 py-2 text-sm text-gray-900 placeholder-gray-400 focus:outline-none dark:text-gray-100 dark:placeholder-gray-500",maxLength:30}),a.length>0&&e.jsxs("div",{className:"flex shrink-0 items-center gap-1.5 pr-2.5",children:[e.jsxs("span",{className:`text-xs select-none ${a.length<4?"text-amber-500 dark:text-amber-400":"text-gray-400 dark:text-gray-500"}`,children:[a.length,"/30"]}),e.jsx("button",{type:"button",onClick:()=>n(""),className:"flex h-5 w-5 cursor-pointer items-center justify-center rounded-full opacity-50 transition-opacity hover:opacity-100",children:e.jsx("img",{className:"h-3.5 w-3.5 dark:invert",src:D,alt:"Clear"})})]})]})}),e.jsx(C,{id:"utm",icon:J,title:i("homepage.settings.utm"),summary:v,isOpen:d.utm,onToggle:()=>b("utm"),children:e.jsx(M,{utmData:h,onChange:p})})]})}const q={url:"",shortUrl:"",isLoading:!1,customAlias:"",utm:{source:"",medium:"",campaign:"",term:"",content:""}};function K(t,r){switch(r.type){case"SET_FIELD":return{...t,[r.field]:r.value};case"SET_LOADING":return{...t,isLoading:r.value};case"RESET_URL":return{...t,url:""};case"SUCCESS":return{...t,shortUrl:r.shortUrl,isLoading:!1};case"SET_UTM":return{...t,utm:r.value};default:return t}}function X(){const t="/cut/shorter",r=window.location.origin,{t:s}=N(),{auth:a}=_(),n=a?.userId,h=Y(),[p,i]=m.useReducer(K,q),{url:d,shortUrl:c,isLoading:b,customAlias:y,utm:u}=p,k=m.useRef(),v=m.useRef(),l=[{value:2592e3,label:s("homepage.urlopt.urtime.month")},{value:604800,label:s("homepage.urlopt.urtime.week")},{value:86400,label:s("homepage.urlopt.urtime.day")},{value:3600,label:s("homepage.urlopt.urtime.hour")}],[o,w]=m.useState(l[0].value);m.useEffect(()=>{v.current.focus()},[]);const R=m.useCallback(async j=>{if(j.preventDefault(),!d){k.current?.addNotification(s("message.urlblank"),3e3);return}try{if(Q(d))throw new Error;let f=d;try{const x=new URL(f);u.source&&x.searchParams.set("utm_source",u.source),u.medium&&x.searchParams.set("utm_medium",u.medium),u.campaign&&x.searchParams.set("utm_campaign",u.campaign),u.term&&x.searchParams.set("utm_term",u.term),u.content&&x.searchParams.set("utm_content",u.content),f=x.toString()}catch(x){console.error("Invalid URL format for UTM appending",x)}i({type:"SET_LOADING",value:!0});const S=(await(n?h:E).post(t,JSON.stringify({url:f,urlTime:o,customAlias:y||void 0}),{headers:{"Content-Type":"application/json"}}))?.data?.shortCode;if(!n){const x=JSON.parse(localStorage.getItem("anonymousLinks")||"[]");x.includes(S)||(x.push(S),localStorage.setItem("anonymousLinks",JSON.stringify(x)))}const O=`${r}/${S}`;i({type:"SUCCESS",shortUrl:O})}catch(f){f?.response?f.response?.status===429?k.current?.addNotification(f.response.data.error||s("message.ratelimit"),5e3):f.response?.status===400?k.current?.addNotification(f.response.data.error||s("message.invalidurl"),3e3):f.response?.status===409?k.current?.addNotification(f.response.data.error||s("message.conflicterror"),3e3):k.current?.addNotification(s("message.urlcuterror"),3e3):k.current?.addNotification(s("message.servererror"),3e3)}finally{i({type:"SET_LOADING",value:!1})}},[o,d,n,h,E,y,u]);return e.jsxs(e.Fragment,{children:[e.jsx(P,{ref:k}),e.jsxs("form",{onSubmit:R,className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:grid md:grid-cols-[minmax(0,1fr)_auto] md:items-start md:gap-6",children:[e.jsxs("div",{className:"flex min-w-0 flex-col items-center gap-4 md:w-[45vw] md:items-stretch lg:w-[50vw] xl:w-[45vw]",children:[e.jsxs("div",{className:"relative flex w-full flex-col items-center md:items-stretch",children:[d&&e.jsx("button",{className:"absolute top-1 left-1 z-10 flex cursor-pointer touch-manipulation items-center justify-center rounded-full p-0.5 md:top-2",onClick:()=>i({type:"RESET_URL"}),type:"button",children:e.jsx("img",{className:"h-6 w-6 opacity-40 transition-opacity hover:opacity-100 dark:invert",src:D,alt:"X"})}),e.jsx(g.input,{ref:v,className:"text-1xl h-16 w-3xs rounded-lg border-2 border-sky-400 bg-white p-2 text-center text-gray-900 shadow-md transition-none! focus:ring-2 focus:ring-sky-500 focus:outline-none md:h-16 md:w-full md:text-2xl lg:h-20 lg:text-3xl dark:border-sky-500 dark:bg-slate-800 dark:text-gray-100 dark:focus:ring-sky-400",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)"},transition:{duration:.8,ease:"easeOut",delay:.1},type:"url",value:d,onChange:j=>{i({type:"SET_FIELD",field:"url",value:j?.target.value})},placeholder:s("homepage.placeholder")})]}),e.jsx("div",{className:"block md:hidden",children:e.jsx(L,{isLoading:b})}),e.jsx(g.div,{className:"motion-safe w-3xs min-w-0 md:w-full",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)"},transition:{duration:.6,ease:"easeOut",delay:.3},children:e.jsx(V,{urlTime:o,setUrlTime:w,urlTimeOptions:l,customAlias:y,setCustomAlias:j=>i({type:"SET_FIELD",field:"customAlias",value:j}),utm:u,setUtm:j=>i({type:"SET_UTM",value:j})})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsx(L,{isLoading:b})})]}),c&&e.jsxs("div",{className:"mb-30 flex flex-col items-center",children:[e.jsxs("div",{className:"mb-30 flex flex-col items-center justify-center gap-5 transition-all duration-300 md:flex-row md:items-stretch md:justify-start md:gap-6",children:[e.jsx(g.div,{className:"text-1xl box-border flex h-16 w-3xs flex-col items-center justify-center overflow-hidden rounded-lg border-2 border-green-500 bg-green-50 p-2 text-center font-semibold text-green-700 shadow-lg transition-all duration-300 md:h-16 md:w-[45vw] md:text-2xl lg:h-20 lg:w-[50vw] lg:text-3xl xl:w-[45vw] dark:border-green-400 dark:bg-slate-800 dark:text-green-300",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)"},transition:{duration:.8,ease:"easeOut",delay:.2},children:e.jsx("span",{className:"select-all",children:c})}),e.jsx(g.div,{className:"motion-safe transition-all duration-300",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)"},transition:{duration:.8,ease:"easeOut",delay:.3},children:e.jsx(z,{shortUrl:c})})]}),e.jsxs(g.div,{className:"motion-safe flex flex-col gap-5 transition-all duration-300 md:flex-col-reverse md:gap-8",initial:{opacity:0,transform:"translateY(100px)"},animate:{opacity:1,transform:"translateY(0px)"},transition:{duration:.8,ease:"easeOut",delay:.4},children:[e.jsx(B,{shortUrl:c}),e.jsx(F,{shortUrl:c,url:d})]})]})]})]})}function ne(){const{t}=N();return e.jsxs($,{children:[e.jsx(A,{children:t("homepage.title")}),e.jsx(X,{})]})}export{ne as default};
